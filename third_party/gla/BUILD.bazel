# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

filegroup(
    name = "specification_files",
    srcs = [
        # Downloaded from https://www.khronos.org/registry/OpenGL/api/GL/glcorearb.h on Ma 13, 2022
        "include/GL/glcorearb.h",
        # Downloaded from https://www.khronos.org/registry/OpenGL/api/GL/glext.h on Ma 13, 2022
        "include/GL/glext.h",
        # https://www.khronos.org/registry/EGL/api/KHR/khrplatform.h on Ma 13, 2022
        "include/KHR/khrplatform.h",
    ],
)

py_binary(
    name = "gla_generator",
    srcs = ["gla_generator.py"],
)

genrule(
    name = "source_generator",
    srcs = [
        ":specification_files",
        "templates/include/GLA/gla.h",
        "templates/src/GLA/gla.c",
    ],
    outs = ["include/GLA/gla.h"],
    cmd = "$(location :gla_generator) --quiet  --header_only --minimum_profile 3.0 --maximum_profile 3.2 --output_directory $(RULEDIR) --extension GL_ARB_framebuffer_object --extension GL_ARB_depth_clamp --extension GL_ARB_seamless_cube_map --extension GL_NVX_gpu_memory_info --extension GL_ATI_meminfo --extension GL_ARB_texture_compression_rgtc --extension GL_ARB_texture_compression_bptc --extension GL_EXT_texture_compression_s3tc --extension GL_EXT_texture_filter_anisotropic --extension GL_EXT_texture_sRGB --extension GL_S3_s3tc",
    tools = [":gla_generator"],
)

cc_library(
    name = "gla",
    hdrs = [
        ":source_generator",
        ":specification_files",
    ],
    includes = ["include"],
    visibility = ["@org_realityforge_q3a//code/renderer:__pkg__"],
)
