load("//build_defs:rules.bzl", "ENGINE_DEFINES", "SERVER_ONLY_ENGINE_DEFINES")

# TODO: Separate out headers for cvars to here? Actually lets create a much better console var library that is probably inspired by the work in q2java modernized
cc_library(
    name = "cvar",
    srcs = ["cvar.c"],
    defines = ENGINE_DEFINES,
    visibility = [
        "//code/client:__pkg__",
        "//code/server:__pkg__",
    ],
    deps = [
        ":qcommon",
        ":shared_api",
    ],
)

cc_library(
    name = "vm",
    srcs = [
        "vm.c",
        "vm_interpreted.c",
    ],
    hdrs = ["vm_local.h"],
    defines = ENGINE_DEFINES,
    visibility = [
        "//code/client:__pkg__",
        "//code/server:__pkg__",
    ],
    deps = [
        ":qcommon",
        ":shared_api",
    ],
)

cc_library(
    name = "files",
    srcs = ["files.c"],
    defines = ENGINE_DEFINES,
    visibility = ["//code/client:__pkg__"],
    deps = [
        ":qcommon",
        ":shared_api",
        "//third_party/unzip",
    ],
)

cc_library(
    name = "files-dedicated",
    srcs = ["files.c"],
    defines = SERVER_ONLY_ENGINE_DEFINES,
    visibility = ["//code/server:__pkg__"],
    deps = [
        ":qcommon",
        ":shared_api",
        "//third_party/unzip",
    ],
)

cc_library(
    name = "net",
    srcs = [
        "huffman.c",
        "md4.c",
        "msg.c",
        "net_chan.c",
        "net_ip.c",
    ],
    defines = ENGINE_DEFINES,
    visibility = [
        "//code/client:__pkg__",
        "//code/server:__pkg__",
    ],
    deps = [
        ":qcommon",
        ":shared",
        ":shared_api",
    ],
)

cc_library(
    name = "net-dedicated",
    srcs = [
        "huffman.c",
        "md4.c",
        "msg.c",
        "net_chan.c",
        "net_ip.c",
    ],
    defines = SERVER_ONLY_ENGINE_DEFINES,
    visibility = ["//code/server:__pkg__"],
    deps = [
        ":qcommon",
        ":shared",
        ":shared_api",
    ],
)

cc_library(
    name = "common",
    srcs = [
        "common.c",
    ],
    defines = ENGINE_DEFINES,
    visibility = ["//code/client:__pkg__"],
    deps = [
        ":qcommon",
        ":shared_api",
    ],
)

cc_library(
    name = "common-dedicated",
    srcs = ["common.c"],
    defines = SERVER_ONLY_ENGINE_DEFINES,
    visibility = ["//code/server:__pkg__"],
    deps = [
        ":qcommon",
        ":shared_api",
    ],
)

cc_library(
    name = "shared",
    srcs = [
        "q_math.c",
        "q_shared.c",
    ],
    visibility = [
        "//code/cgame:__pkg__",
        "//code/game:__pkg__",
        "//code/q3_ui:__pkg__",
        "//code/ui:__pkg__",
    ],
    deps = [
        ":shared_api",
    ],
)

cc_library(
    name = "shared_api",
    hdrs = [
        "cvar_common.h",
        "cvar_engine.h",
        "q_platform.h",
        "q_shared.h",
        "qboolean.h",
        "qengine.h",
        "surfaceflags.h",
    ],
    visibility = [
        "//code/botlib:__pkg__",
        "//code/cgame:__pkg__",
        "//code/client:__pkg__",
        "//code/game:__pkg__",
        "//code/q3_ui:__pkg__",
        "//code/renderercommon:__pkg__",
        "//code/server:__pkg__",
        "//code/sys:__pkg__",
        "//code/ui:__pkg__",
        "//third_party/unzip:__pkg__",
    ],
)

cc_library(
    name = "qfiles",
    hdrs = ["qfiles.h"],
    visibility = [
        "//code/renderergl1:__pkg__",
        "//code/renderergl2:__pkg__",
    ],
)

# collision map library
cc_library(
    name = "cm",
    srcs = [
        "cm_load.c",
        "cm_local.h",
        "cm_patch.c",
        "cm_patch.h",
        "cm_polylib.c",
        "cm_polylib.h",
        "cm_test.c",
        "cm_trace.c",
    ],
    hdrs = ["cm_local.h"],
    defines = ENGINE_DEFINES,
    visibility = [
        "//code/client:__pkg__",
        "//code/server:__pkg__",
    ],
    deps = [
        ":qcommon",
        ":shared_api",
    ],
)

cc_library(
    name = "qcommon",
    hdrs = [
        "cm_public.h",
        "qcommon.h",
    ],
    includes = ["."],
    visibility = [
        "//code/botlib:__pkg__",
        "//code/cgame:__pkg__",
        "//code/client:__pkg__",
        "//code/renderergl1:__pkg__",
        "//code/renderergl2:__pkg__",
        "//code/sdl:__pkg__",
        "//code/server:__pkg__",
        "//code/sys:__pkg__",
        "//third_party/unzip:__pkg__",
    ],
    deps = [
        ":qfiles",
        ":shared_api",
    ],
)

_CMD_SRC = ["cmd.c"]

cc_library(
    name = "cmd",
    srcs = _CMD_SRC,
    defines = ENGINE_DEFINES,
    visibility = ["//code/client:__pkg__"],
    deps = [
        ":qcommon",
        ":shared_api",
    ],
)

cc_library(
    name = "cmd-dedicated",
    srcs = _CMD_SRC,
    defines = SERVER_ONLY_ENGINE_DEFINES,
    visibility = ["//code/server:__pkg__"],
    deps = [
        ":qcommon",
        ":shared_api",
    ],
)
